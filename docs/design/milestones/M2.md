---
doc_version: 2025-10-21.r1
title: M2 — OIDC Integration via Authelia
---

# M2 — OIDC (OAuth 2.1 + PKCE) via Authelia

## Scope
- Integrate Authelia as OIDC Provider (OP).
- FastAPI resource server validates JWTs: issuer (iss), audience (aud), exp/nbf, signature.
- Key rotation via JWKs (JWKS endpoint caching + kid selection).

## Architecture
- Browser → Authelia (Auth Code + PKCE) → client obtains tokens.
- Client calls MCP Devhatchery API with Bearer access_token.
- API middleware verifies JWT and sets OwnerContext from sub/claims.

## Validation
- Unit tests for JWT validation (happy path + clock skew + aud/iss mismatch).
- Integration test: mocked JWKS with rotated keys.

## Risks
- Clock skew; JWKS cache staleness; token replay.

## Open Questions
- Multi-tenant audiences? Multiple client_ids?